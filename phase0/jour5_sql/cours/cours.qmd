---
title: "SQL - Niveau 1"
author: "Olivier SAVRIAMA"
date: today
format:
  revealjs:  
    theme: [white, simple]
    slide-number: c/t
    progress: true
    transition: slide
    code-copy: true
    code-line-numbers: true
    toc: true
    toc-depth: 2
    incremental: true
    chalkboard: true
    controls: true
    scrollable: true
---

## Bienvenue ğŸ‘‹

- Objectif du jour : **comprendre** et **pratiquer** les bases de SQL via lâ€™univers **Dragon Ball Z**:  
  - SGBD
  - tables & clÃ©s
  - **types**
  - **instructions** (CREATE/INSERT/SELECT/ALTER/UPDATE/DELETE)
  - **contraintes**

---

## Plan & repÃ¨res

1) Introduction aux **SGBD**  
2) Bases relationnelles (tables, PK/FK, schÃ©ma)  
3) **Types** (SQLite)  
4) **Instructions** SQL : DDL / DML / DQL  
5) **CRUD (Create, Read, Update, Delete)**
6) **Contraintes**  
7) Mini-projet guidÃ© (DBZ)

---

## 1) Introduction aux SGBD

- **SGBD** : logiciel qui stocke, protÃ¨ge et permet de requÃªter les donnÃ©es.  
- Exemples : SQLite, PostgreSQL, MySQL, SQL Server.
- On pratique avec **SQLite** (base = fichier `.db`).

**Pourquoi SQLite ?** rapide, portable, parfait pour lâ€™apprentissage.

::: notes
Question brise-glace : â€œQui a dÃ©jÃ  utilisÃ© Excel ?â€ â†’ faire le parallÃ¨le â€œfeuillesâ€ vs â€œtablesâ€.
:::

---

## 2) Bases relationnelles â€” concepts

- **Table** = lignes (enregistrements) Ã— colonnes (attributs)  
- **PK (clÃ© primaire)** = identifiant unique (ex. `id`)  
- **FK (clÃ© Ã©trangÃ¨re)** = lien vers une autre table (rÃ©fÃ©rence)  
- **SchÃ©ma** = description des tables, colonnes et contraintes

**Exemple, tables de l'univers DBZ** : `teams` (Ã©quipes), `characters` (personnages), `sagas`, `battles`, `character_battles` (participations)

::: notes
Astuce visuelle : dessiner sur le tableau `teams (id, name)` â†’ `characters (team_id â†’ teams.id)`.
:::

---

## 3) Types (SQLite)

- **INTEGER** (entiers), **REAL** (rÃ©els), **TEXT** (chaÃ®nes), **BLOB** (binaire)  
- `NULL` = absence de valeur (â‰  `0` ou `''`)
- Dâ€™autres SGBD ajoutent `DATE`, `TIMESTAMP`, `BOOLEAN`, etc.

**RÃ¨gle simple** : choisissez le type **le plus simple** qui convient.

---

## 4) Les instructions SQL

- **DDL** (dÃ©finition) : `CREATE`, `ALTER`, `DROP`  
- **DML** (manipulation) : `INSERT`, `UPDATE`, `DELETE`  
- **DQL** (requÃªte) : `SELECT`

---

## CREATE â€” crÃ©er une table

On va crÃ©er 2 tables minimales pour dÃ©marrer.

```sql
-- 1) Table des Ã©quipes
CREATE TABLE IF NOT EXISTS teams (
  id   INTEGER PRIMARY KEY,
  name TEXT    NOT NULL,
  base TEXT
);

-- 2) Table des personnages (rÃ©fÃ©rence vers teams)
CREATE TABLE IF NOT EXISTS characters (
  id          INTEGER PRIMARY KEY,
  name        TEXT    NOT NULL,
  race        TEXT,
  power_level INTEGER,
  team_id     INTEGER,
  FOREIGN KEY (team_id) REFERENCES teams(id)
);
```

::: notes
DÃ©monstration live :
1) CrÃ©er les tables  
2) Montrer quâ€™aucune ligne nâ€™existe encore (`SELECT * FROM teams;`)
:::

---

## INSERT â€” ajouter des lignes

```sql
INSERT INTO teams (id, name, base) VALUES
  (1, 'Z-Fighters', 'Kame House'),
  (2, 'Forces de Freezer', 'Vaisseau de Freezer');

INSERT INTO characters (id, name, race, power_level, team_id) VALUES
  (1, 'Goku',    'Saiyan',        3000000, 1),
  (2, 'Vegeta',  'Saiyan',        2500000, 1),
  (3, 'Piccolo', 'Namekian',      1200000, 1),
  (4, 'Krillin', 'Humain',         300000, 1);
```

**Astuce** : `INSERT` multi-lignes pour remplir plus vite.

---

## SELECT â€” lire les donnÃ©es

```sql
-- Toutes les colonnes
SELECT * FROM teams;

-- Colonnes choisies + tri + limite
SELECT id, name, base
FROM teams
ORDER BY name ASC
LIMIT 5;
```

**Bon rÃ©flexe** : afficher seulement les colonnes utiles (Ã©viter `SELECT *` en prod).

::: notes
Mini-quiz : â€œComment afficher seulement `name` et `power_level` de `characters` triÃ©s par puissance dÃ©croissante ?â€
:::

---

## ALTER â€” changer la structure

```sql
ALTER TABLE teams ADD COLUMN created_at TEXT;
```

- Sert Ã  **ajouter** une colonne (SQLite).  
- Dans dâ€™autres SGBD, on peut aussi **renommer**, **changer le type**, etc.

---

## UPDATE â€” modifier des valeurs

```sql
UPDATE teams
SET base = 'Capsule Corp.'
WHERE name = 'Z-Fighters';
```

**SÃ©curitÃ©** : toujours tester le `WHERE` avec un `SELECT` avant le `UPDATE`.

---

## âš ï¸ SÃ©curitÃ© avec UPDATE / DELETE

- Avant dâ€™exÃ©cuter un `UPDATE` ou `DELETE`, **toujours tester un `SELECT` avec un `WHERE`**.  
- Cela Ã©vite les erreurs de mise Ã  jour/suppression massive. 
Exemple :
```sql
-- Ã‰tape 1 : tester
SELECT * FROM characters
WHERE name = 'Goku';
-- Ã‰tape 2 : appliquer
UPDATE characters
SET power_level = power_level * 2
WHERE name = 'Goku';
```
ğŸ‘‰ RÃ©sultat : seul **Goku** est modifiÃ©, pas toute la table.

---

## DELETE â€” supprimer des valeurs

```sql
DELETE FROM teams
WHERE name = 'Forces de Freezer';
```

âš ï¸ : sans `WHERE`, on supprime **toutes** les lignes.

---

## Contraintes (rappel)

- `PRIMARY KEY` : unicitÃ© + identitÃ©  
- `NOT NULL` : valeur obligatoire  
- `UNIQUE` : pas de doublon  
- `CHECK` : rÃ¨gle mÃ©tier (ex. `power_level > 0`)  
- `FOREIGN KEY` : cohÃ©rence entre tables

---

**Exemple** (PK + NOT NULL + FK) :

```sql
CREATE TABLE IF NOT EXISTS characters (
  id          INTEGER PRIMARY KEY,
  name        TEXT NOT NULL,
  race        TEXT,
  power_level INTEGER,
  team_id     INTEGER,
  FOREIGN KEY (team_id) REFERENCES teams(id)
);
```

---

## Erreurs frÃ©quentes & solutions

- Oublier le `WHERE` â†’ mises Ã  jour/suppressions massives non voulues  
- Conflits de PK/UNIQUE â†’ vÃ©rifier les valeurs de `id`/`name`  
- FK non respectÃ©e â†’ la valeur rÃ©fÃ©rencÃ©e nâ€™existe pas dans la table parent  
- Virgule manquante dans `INSERT` multi-lignes  
- Majuscules/minuscules : SQL est tolÃ©rant pour les mots-clÃ©s, pas pour les valeurs

---

# RÃ©cap express (Ã  retenir)

- **Tables** + **PK/FK** = base du relationnel  
- **Types** simples (INTEGER / REAL / TEXT) suffisent souvent  
- **CRUD** : CREATE â†’ INSERT â†’ SELECT â†’ ALTER/UPDATE/DELETE  
- **Contraintes** â†’ data propre et fiable  
- Tester **par petites Ã©tapes**, souvent !

---

## Pour aller plus loin (aprÃ¨s-cours)

- Ajouter une contrainte `CHECK (power_level > 0)` sur `characters`  
- Introduire `DISTINCT`, `LIMIT`, `ORDER BY` systÃ©matiquement  
- PrÃ©parer le **Niveau 2** : JOINs, HAVING, CASE, sous-requÃªtes

::: notes
Clore en rappelant oÃ¹ se trouvent les notebooks/exercices.
Encourager Ã  pratiquer rÃ©guliÃ¨rement.
:::

---

Fin ğŸ‰